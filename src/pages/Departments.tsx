import { useState, useMemo } from 'react';
import Header from '@/components/Header';
import Sidebar from '@/components/Sidebar';
import SidebarCards from '@/components/SidebarCards';
import { Button } from '@/components/ui/button';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
// ✅ Добавлены иконки для лайтбокса
import { Play, TrainFront, Bolt, HardHat, TrafficCone, Laptop, BookOpen, ChevronRight, X, ChevronLeft } from 'lucide-react';
import InfoBlocks from '@/components/InfoBlocks';

// Импорты изображений
import ob from '@/assets/pictures/ob.png';
import vag from '@/assets/pictures/vag.png';
import pm from '@/assets/pictures/pm.png';
import ad from '@/assets/pictures/ad.png';
import ct from '@/assets/pictures/ctpoitel.png';
import person from '@/assets/pictures/person.png';
import akimov from '@/assets/pictures/akimov1.png';
import perevozchikov from '@/assets/pictures/perevozchikov.png';
import tcykanova from '@/assets/pictures/tcykanova.png';
import gamachek from '@/assets/pictures/gamachek.png';

const Departments = () => {
  const [selectedDepartment, setSelectedDepartment] = useState<number | null>(null);
  const [isDescriptionOpen, setIsDescriptionOpen] = useState(false);
  // ✅ Состояние для лайтбокса аватарки
  const [lightboxImage, setLightboxImage] = useState<string | null>(null);

  const departments = [
     {
      id: 1,
      name: 'Отделение технической эксплуатации подвижного состава ж/д',
      icon: TrainFront,
      color: 'blue', // ✅ Возвращены уникальные цвета
      specialties: [
        'Техническая эксплуатация подвижного состава железных дорог (электровозы, тепловозы)',
        'Техническая эксплуатация подвижного состава железных дорог (вагоны)'
      ],
      head: 'Ярцева Ольга Борисовна',
      description: `Специальности:\n- Техническая эксплуатация подвижного состава железных дорог (электровозы, тепловозы);\n- Техническая эксплуатация подвижного состава железных дорог (вагоны).\n\nОтделение существует со дня образования техникума, с 1930 года. В разные годы имело названия: «Вагоны и вагонное хозяйство», «Паровозы и паровозное хозяйство», «Изотермический подвижной состав и холодильное хозяйство». Сегодня – это отделение 23.02.06 Технической эксплуатации подвижного состава железных дорог.\n\nВ настоящее время обучение специалистов ведется по двум направлениям «Локомотивы» и «Вагоны». Студенты получают знания и навыки в области организации производственных работ, технического обслуживания и эксплуатации подвижного состава железных дорог. Стать хорошим специалистом помогают опытные преподаватели, а также учебно-лабораторная база техникума.\n\nВозглавляет отделение Ярцева Ольга Борисовна.\n\nБольшой вклад в развитие отделения внесли:\nЛ.И.Какоткина, многие годы проработавшая заведующей отделением, выпускница техникума, отдавшая техникуму более 40 лет, отличник среднего специального образования; А.Ф. Слюсаренко, председатель цикловой комиссии, Почетный железнодорожник.\n\nВ разное время здесь трудились также опытные преподаватели, имеющие стаж работы в техникуме более 30 лет: А. М. Бахмат, Т.Ф. Мартынова, А. П. Дураченко. Более 20 лет проработали на отделении ветераны труда: В.В. Криворучко – Почетный железнодорожник; Н.Н. Марченко, А.И. Мирошников – преподаватели специальных дисциплин.\n\nВ настоящее время на отделении продолжает работать опытный специалист, не один десяток лет отдавшая делу обучения молодежи – это Л.Н. Чайкина.\n\nДостойный вклад в становление специалистов вносят сегодня педагоги-производственники: С.Н.Шатов, О.В.Бунич, С.А.Новиков, С.Н.Трачук, В.Б.Крымпоха, Т.Г. Яковлева, А.В.Скрипниченко.\n\nМногие выпускники стали гордостью техникума, среди них: Ю.С.Иванько – Почетный железнодорожник, начальник рефрижераторного вагонного депо «Тихорецкая» «Рефсервис ОАО «РЖД»; Е.Я. Горох – Почетный железнодорожник; Ю.А. Сарвилкин – директор Тихорецкого техникума железнодорожного транспорта с 01.02.91 г. по 31.03.97 г; Н.И. Черкашин – начальник вагонного отделения Грозненского отделения СКЖД; В.И. Ушаков – начальник Тихорецкого локомотивного депо с 1979 по 1991 гг.; А.Н.Лихобабин – начальник отдела кадров ст.Тихорецкая и другие.\n\nВ рамках освоения специальности студенты получают рабочие профессии: слесарь по ремонту подвижного состава, помощник машиниста тепловоза и электровоза, осмотрщик-ремонтник вагонов, проводник пассажирского вагона. Имея эти профессии, студенты старших курсов проходят производственную практику на предприятиях железнодорожного транспорта.\n\nВыпускники отделения востребованы как специалисты на предприятиях не только Северо-Кавказской железной дороги, но и далеко за ее пределами.`,
      departmentImage: vag,
      headPhoto: person,
      videoUrl: 'https://rutube.ru/video/98338d34561bd75e1d0504ab9a2e2808/'
    },
    {
      id: 2,
      name: 'Отделение электромеханики',
      icon: Bolt,
      color: 'yellow',
      specialties: [
        'Техническая эксплуатация ПТ, строительных, дорожных машин и оборудования',
        'Сварочное производство',
        'Электроснабжение'
      ],
      head: 'Акимов Роман Сергеевич',
      description: `Специальности:\n- Техническая эксплуатация подъемно - транспортных, строительных, дорожных машин и оборудования (по отраслям);\n- Сварочное производство;\n- Электроснабжение.\n\nСпециальность – Путевые и строительные машины железнодорожного транспорта – так она называлась, одна из самых старых в техникуме, открыта в 1955 году. Выпущено более 3500 специалистов среднего руководящего состава.\n\nВ связи с большой потребностью специалистов на предприятиях ОАО «РЖД» в 2006 году были открыты специальности Электроснабжение и Сварочное производство.\n\nВозглавляет отделение выпускник техникума – Акимов Роман Сергеевич.\n\nЗа годы работы отделения создана мощная материально-техническая база. Отделение располагает хорошо оснащенными кабинетами, современным действующим оборудованием, лабораториями и действующими полигонами.\n\nЗначительный вклад в развитие специальностей внесли ветераны, бывшие заведующие отделением: Н.А. Гормай - ветеран труда; Б.Н. Харичкин - Почетный железнодорожник; Т.Ф. Обрезанова - отличник среднего специального образования; В. Л. Куликов за многолетний, плодотворный труд на железнодорожном транспорте награжден именными часами начальника Северо-Кавказской железной дороги.\n\nВедущими преподавателями являются: О.В. Сафронова, выпускница Тихорецкого техникума железнодорожного транспорта, А.Н. Березкин, М.А. Вайдман, С.Н. Есипенко, А.Н. Юрченко, преподаватели специальных дисциплин.\n\nВсегда интересно студентам со своими классными руководителями, наставниками и друзьями: Бурняшевой Е.В., Выставкиной О.В. Новиковой И.В. и тд. Преподаватели поддерживают тесную связь с выпускниками: Барановым В.Н. – кандидатом экономических наук, президентом «Союза независимых производителей газа», выпускником 1980 года. Отделение стало кузницей руководящих кадров для многих предприятий, так на ОАО «Машиностроительный завод им. В.В. Воровского» работает выпускник техникума: Мезин В.А. – управляющий директор, Г.Е. Нахтегаль – заместитель начальника дирекции по ремонту пути. Выпускники техникума, активно передают свой производственный опыт молодежи.\n\nСтуденты, обучающиеся на отделении получают все виды именных стипендий: стипендия имени П.П.Мельникова, начальника СКЖД, главы Тихорецкого района, молодежной стипендии администрации Краснодарского края.\n\nЗа период обучения студенты отделения получают дополнительные профессии по специальности: слесарь по ремонту путевых машин, машинист ЖДСМ, электромонтер контактной сети, электромонтер тяговой подстанции, газоэлектросварщик, дефектоскопист по магнитному и ульразвуковому контролю. Получение дополнительных рабочих профессий студентами позволяет обеспечить 100% распределение выпускников.\n\nСтуденты техникума помнят и гордятся выпускниками, отдавшими жизнь, защищая Отечество в Афганистане и Чечне: Коляниченко Константином, выпускник 1983 года, награжден Орденом Красного знамени и Воробьевым Евгением, выпускник 1999 года, награжден Орденом Мужества.`,
      departmentImage: pm,
      headPhoto: akimov,
      videoUrl: 'https://rutube.ru/video/4f5729f0f402d2c74b6c63c9233a0b82/'
    },
     {
      id: 3,
      name: 'Строительное отделение',
      icon: HardHat,
      color: 'orange',
      specialties: [
        'Строительство железных дорог, путь и путевое хозяйство',
        'Строительство и эксплуатация зданий и сооружений'
      ],
      head: 'В.В. Перевозчиков',
      description: `Специальности:\n- Строительство железных дорог, путь и путевое хозяйство;\n- Строительство и эксплуатация зданий и сооружений.\n\nСпециальность 08.02.10 «Строительство железных дорог, путь и путевое хозяйство» открыта в техникуме в 1990 году. Выпускники данной специальности призваны решать задачи по организации строительства железных дорог, выполнению работ по устройству, содержанию, ремонту пути и других сооружений путевого хозяйства.\n\nНа этом отделении сложно, почетно и интересно работать, отделение возглавляет В.В.Перевозчиков.Значительный вклад в развитие специальностей внесли: первый заведующий отделением А.Н. Лищенко, Почетный железнодорожник, проработавший в техникуме более 30 лет, Л.Н. Томилина, выпускница Тихорецкого техникума железнодорожного транспорта 1984 года, возглавлявшая отделение с 2001 по 2005 годы, В.П. Попов, бывший начальник Тихорецкой дистанции пути ПЧ-6. По данной специальности готовят выпускников опытные производственники инженера: Берёзкина Т.А, Орищенко А.Н, Жестеров С.С, Перевозчиков В.В, Кочеткова Т.Г.\n\nСпециальность 08.02.01 «Строительство и эксплуатация зданий и сооружений» открыта в 2000 году. В 2004 году состоялся первый выпуск студентов.: Основными видами деятельности данной специальности являются: организация и проведение работ по проектированию, строительству, эксплуатации, ремонту и реконструкции зданий и сооружений.. Готовят выпускников к профессиональной деятельности по строительству, эксплуатации и реконструкции жилых, общественных и промышленных объектов в качестве техника опытные инженеры: Т.А Берёзкина, Волкова Е.В.\n\nВ настоящее время на отделении созданы благоприятные условия, создана большая материальная база для подготовки специалистов в этом направлении обучения. Для плодотворной работы, занятий техническим творчеством, получения студентами первичных профессиональных навыков на отделении имеется кабинеты и лаборатории с необходимым оборудованием и инструментом. В учебных мастерских, учебном полигоне, студенты получают профессиональные навыки по слесарным работам, сварочным работам, дефектоскопии, выявление дефектов и устранении неисправности в пути, обучаются геодезическим, каменным работам, облицовочным, отделочным работам в строительстве.\n\nСтуденты принимают активное участие в конкурсах «Лучший по профессии», во всероссийском чемпионатном движении по профессиональному мастерству «Профессионалы» где показывают свои приобретенные навыки и мастерство, являются активными участниками сетевых выставок, дорожных смотров-конкурсов технического творчества.\n\nЗа отличные успехи в учебе, участие в различных смотрах и конкурсах студент группы П-4-1 Кузнецов Кирилл является победителем всероссийского конкурса профессионального мастерства «Молодые профессионалы железных дорог» организованного при поддержке Федерального агентства железнодорожного транспорта и ОАО «РЖД» , студентка группы П-4-1 Чернышева Каролина является победителем регионального чемпионата по профессиональному мастерству «Профессионалы», студент группы П-3-1 Дымченко Михаил является стипендиатом начальника Северо-Кавказской железной дороги филиала ОАО РЖД.\n\nЗа большой вклад в дело обучения и воспитания подрастающего поколения и активное участие в научно-исследовательской работе Почетными грамотами награждены преподаватель специальных дисциплин Т.А. Березкина, А.Н Орищенко. Умеют найти особый подход к студентам, и заслуженно являются лучшими классными руководителями отделения: Т.А. Берёзкина, Е.Ю. Сингаева, С.В. Марушан, А.Н. Орищенко, С.С. Жестеров.`,
      departmentImage: ct,
      headPhoto: perevozchikov,
      videoUrl: 'https://rutube.ru/video/bfb45668da5a62d3c20419dfe81959d5/'
    },
    {
      id: 4,
      name: 'Отделение автоматики и организации перевозок',
      icon: TrafficCone,
      color: 'green',
      specialties: [
        'Автоматика и телемеханика на транспорте (ж/д)',
        'Организация перевозок и управление на транспорте'
      ],
      head: 'Т.В. Цуканова',
      description: `Специальности:\n- Автоматика и телемеханика на транспорте (на железнодорожном транспорте);\n- Организация перевозок и управление на транспорте (по видам).\n\nСпециальности «Автоматика и телемеханика на транспорте», «Организация перевозок и управление на транспорте» одни из молодых и престижных специальностей. Открыты в Тихорецком техникуме железнодорожного транспорта – филиале РГУПС в 2000 году и являются на сети железных дорог самыми востребованными.\n\nМатериально-техническая база отделения оснащена современным действующим оборудованием, новейшими техническими средствами обучения. Кабинеты профессиональных модулей компьютеризированы и оборудуются по последним требованиям обучения. На полигоне техникума имеются устройства сигнализации и блокировки: модуль МК, КТСМ-01Д, АПС, УЗП, которые отвечают современным требованиям к учебному процессу и позволяют получать практические и профессиональные навыки. На уроках профессиональных модулей и междисциплинарных курсов студенты работают с программным обеспечением АОС-ШЧ, которое обеспечивает подачу теоретических знаний и умений, контроль знаний и тренировку поиска неисправностей по специальности.\n\nГордостью техникума и отделения является база, оснащенная современными действующими макетами, оборудовано автоматизированное рабочее место дежурного диспетчера АРМ-ДНЦ, позволяют приблизить учебный процесс к естественным условиям и осуществлять качественную подготовку и переподготовку дежурных по станции.\n\nпри работе с которым студенты могут на мониторе компьютера осуществлять построение графика и наглядно видеть порядок пропуска поезда по участку. Тренажер горочного комплекса – виртуальная железная дорога. Возможности тренажера позволяют приблизить учебный процесс к естественным условиям и осуществлять качественную подготовку и переподготовку дежурных по станции. Учебный кабинет по профессии Поездной участковый диспетчер, Дежурный по железнодорожной станции, передан ОАО «РЖД» в рамках программы взаимодействия с университетскими комплексами железнодорожного транспорта. Тренажер позволяет моделировать поездную ситуацию, дает возможность выбора нескольких наиболее приемлемых решений, позволяет оценить результат выбранного решения, дает рекомендации для каждой оперативной ситуации и оценивает результаты работы.\n\nВ 2007 году отделение возглавила Т.В. Цуканова, которая работала в техникуме с момента становления специальности. Под «ее крылом» растут молодые выпускники отделения.\n\nВедущими преподавателями и работниками отделения являются опытные производственники, такие как: М.В. Токарев, который более 10 лет занимал руководящие должности заместителя начальника и начальника железнодорожных станции Приволжской железной дороги–филиала ОАО «РЖД», Игнатьев В.Ю. более 20 лет проработал на железнодорожной станции Тихорецкая, пройдя путь от помощника составителя до заместителя начальника станции, Буйная Ю.А. пришла в техникум с опытом работы дежурного по станции им. М.Горького. Прививают любовь к избранной профессии, передают свои знания студентам отделения замечательные педагоги: Ю.О. Яковлева, М.В. Ивакина, Н.А. Рашевская, Ю.С. Тюльпинова. Работу цикловой комиссии возглавляет грамотный преподаватель А.А. Сырый.\n\nВ 2004 году осуществлен первый выпуск молодых специалистов, которые были распределены на предприятия Северо-Кавказской железной дороги, на железнодорожные станции и в дистанции сигнализации, централизации и блокировки: Туапсе, Кавказская, Краснодар, Тимашевская, Крымская, Тихорецкая, Сальск. На сегодняшний момент география распределения дошла до Калининградской железной дороги и Крымской железной дороги.\n\nНаши выпускники - командиры на железной дороге, которые отвечают за безопасность движения поездов. Среди известных выпускников техникума А.Г. Тулеев - губернатор Кемеровской области, В.И. Ильин – бывший первый заместитель министра путей сообщения, Ю.Г. Кравченко - начальник железнодорожного вокзала ст. Новороссийск и другие. Выпускники специальности «Организация движения и управление на транспорте» могут работать: дежурными по станции, операторами поста централизации, приемосдатчиками груза и багажа, сигналистами, составителями и др.\n\nЗа период учебного процесса студенты отделения получают дополнительные профессии по специальностям: оператор поста централизации, оператор СТЦ, сигналист, приемосдатчик груза и багажа, электромонтер СЦБ.\n\nУже несколько лет подряд выпускники отделения специальностей «Автоматика и телемеханика» и «Организация перевозок и управление на транспорте» получают гранты на разработку дипломных проектов по заданию железных дорог с целью дальнейшего внедрения, успешно их защищают.\n\nС каждым годом отделение развивается все стремительней. Педагогический коллектив ведет поиск новых методик преподавания, активных форм обучения. Может быть, поэтому число желающих обучаться на этом отделении с каждым годом растет.`,
      departmentImage: ad,
      headPhoto: tcykanova,
      videoUrl: 'https://rutube.ru/video/9b67567b44a0bd391b55ef9675bba3e0/'
    },
    {
      id: 5,
      name: 'Отделение информационных технологий и экономики',
      icon: Laptop,
      color: 'purple',
      specialties: [
        'Компьютерные системы и комплексы',
        'Техническая эксплуатация транспортного радиоэлектронного оборудования',
        'Экономика и бухгалтерский учет'
      ],
      head: 'Гамачек С.А.',
      description: `Специальности:\n- Компьютерные системы и комплексы;\n- Техническая эксплуатация транспортного радиоэлектронного оборудования (по видам транспорта);\n- Экономика и бухгалтерский учет (по отраслям)\n\nПостроение и развитие информационного общества признается ведущей мировой тенденцией XXI в., определяющей необходимость подготовки специалистов для инновационной экономики, основой которой являются информационные системы и технологии. Сегодня в обществе невозможно представить предприятие, организацию, технологический процесс, производство, учебный процесс или индустрию развлечений без использования компьютерной техники и программного обеспечения. Информационные технологии, совершенствуясь сами, видоизменяют бизнес: механизмы его ведения, способы коммуникации, оказания услуг и производства товаров – идет построение информационного общества. Именно поэтому специальности отделения Информационных технологий и экономики являются наиболее востребованными не только в России, но и в мире.\n\nСпециальность 09.02.01 «Компьютерные системы и комплексы» – та специальность, получив которую у выпускников уже не будет необходимости думать о том, как устроиться на работу. Профессионалы в области компьютерных технологий нужны сейчас нашей стране, как никогда раньше. Проектирование цифровых устройств, применение микропроцессорных систем, установка и настройка периферийного оборудования, сетевое администрирование, защита информации, проектирование кабельной структуры, установка, настройка и обслуживание технических и программно – аппаратных средств – вот далеко не полный перечень того, чему научится вчерашний школьник, поступивший на специальность «Компьютерные системы и комплексы».\n\nВ данной специальности соединены две составляющие вычислительной техники: аппаратная (изучение электронной и цифровой техники) и слаботочные инженерные системы зданий (локально-вычислительные сети, системы видеонаблюдения, охранно-пожарные системы, системы контроля и управления доступом, IP-телефония).\n\nОбласть профессиональной деятельности выпускников: сопровождение, настройка и администрирование системного и сетевого программного обеспечения; эксплуатация, обслуживание серверного и сетевого оборудования; диагностика и мониторинг работоспособности программно-технических средств; обеспечение целостности резервирования информации и информационной безопасности объектов сетевой инфраструктуры.\n\nСпециальность 11.02.06 Техническая эксплуатация транспортного радиоэлектронного оборудования (по видам транспорта)\n\nДинамичное развитие отрасли, увеличение количества и качества услуг, предоставляемых предприятиями связи, порождает возрастающий спрос на квалифицированных специалистов. В настоящее время связь - одно из наиболее быстро развивающихся направлений инфраструктуры общества.\n\nДля обеспечения эффективной работы всех подразделений и служб железнодорожного транспорта необходима современная и надежная система управления технологическими процессами. Решающую роль в этом играет связь.\n\nОсновной вид связи на железнодорожном транспорте — оперативно-технологическая связь (ОТС). Так, машинист локомотива может в любой момент связаться по радио с дежурным по станции, поездным диспетчером, а при необходимости — с машинистами других локомотивов. Дежурные по станции могут связываться друг с другом, с машинистами локомотивов, с руководителями маневров и с поездным диспетчером. Ремонтные бригады (путейцы, электрики и др.), работающие на перегоне, также оснащены средствами связи.\n\nВ последнее десятилетие все шире ставятся новые задачи для связи — передача данных. Область применения: управление перевозочным процессом, централизованный учет почтовых операций, управление материально-техническим обеспечением, банковские операции.\n\nНа железной дороге нашли применение все известные виды связи от радиосвязи (для связи с подвижными объектами) до самых современных — волоконно-оптической связи (сигнал передается не по медному кабелю, а световым лучом по стеклянным волокнам, толщиной в человеческий волос). Волоконно-оптическая связь позволяет значительно увеличить пропускную способность при передаче информации и значительно уменьшить потери. Данные передаются с высокой скоростью и на большие расстояния.\n\nНа специальность принимаются как юноши, так и девушки. Студенты, окончившие техникум по данной специальности, будут заниматься эксплуатацией и ремонтом оборудования связи, работать электромеханиками и механиками систем связи на предприятиях Северо-Кавказской железной дороги, в проектных организациях, а также в коммерческих структурах «Транстелеком», «Ростелеком» или операторами сотовой связи.\n\nДанная профессия очень интересна и перспективна, специалисты получают достойную заработную плату, имеют возможности роста по службе.\n\n38.02.01 Экономика и бухгалтерский учет (по отраслям)\n\nВ условиях высокоразвитой системы товарно-рыночных отношений и процветания различных форм бизнеса потребность в квалифицированных работниках, специализирующихся на ведении бухгалтерского учёта, растёт с каждым днем.\n\nПриоритетность бухгалтерской профессии определяется сейчас интересами государства и потребностями собственника, причем требования к бухгалтеру постоянно повышаются. Развитие профессии бухгалтера идет путем повышения интеллектуального и образовательного уровня. Пока существует государство, а с ним налоговая система и финансовая отчетность, останется спрос на профессию бухгалтера.\n\nБухгалтерское образование требуется в финансово-кредитных учреждениях, страховых компаниях, налогово-бюджетных и государственных органах, на промышленных предприятиях, в торговых компаниях на должностях руководителей организаций, главных бухгалтеров, финансовых директоров, бухгалтеров, менеджеров различных уровней управления, аудиторов.\n\nДля работодателя важен опыт бухгалтера в конкретной сфере деятельности, хорошее владение бухгалтерскими программами, знание налогового законодательства.\n\nОбластью профессиональной деятельностью выпускников является учет имущества и обязательств организации, проведение и оформление хозяйственных операций, обработка бухгалтерской информации, проведение расчетов с бюджетом и внебюджетными фондами, формирование бухгалтерской отчетности, налоговый учет, налоговое планирование.\n\nБухгалтер готовится к следующим видам деятельности: документирование хозяйственных операций и ведение бухгалтерского учета имущества организации; ведение бухгалтерского учета источников формирования имущества, выполнение работ по инвентаризации имущества и финансовых обязательств организации; проведение расчетов с бюджетом и внебюджетными фондами; составление и использование бухгалтерской отчетности; выполнение работ по одной или нескольким профессиям рабочих, должностям служащих.`,
      departmentImage: ob,
      headPhoto: gamachek,
      videoUrl: 'https://rutube.ru/video/9714e413cad2ff1d9a88116ebf3b78cb/'
    }
  ];

  const activeDepartment = useMemo(() => {
    if (selectedDepartment === null) return null;
    return departments.find(d => d.id === selectedDepartment);
  }, [selectedDepartment]);

  const openDescriptionModal = (deptId: number) => {
    setSelectedDepartment(deptId);
    setIsDescriptionOpen(true);
  };
  
  // ✅ Новая функция для красивого рендеринга описания
  const renderDescription = (description: string) => {
    // Определяем ключевые фразы для заголовков
    const headings = [
      'Специальности:',
      'Возглавляет отделение', 
      'Большой вклад в развитие', 
      'В разное время здесь трудились',
      'В настоящее время на отделении',
      'Достойный вклад в становление',
      'Многие выпускники стали гордостью', 
      'В рамках освоения специальности',
      'Выпускники отделения востребованы',
      'За годы работы отделения',
      'Ведущими преподавателями являются:',
      'Всегда интересно студентам',
      'Студенты, обучающиеся на отделении',
      'За период обучения студенты',
      'Студенты техникума помнят',
      'На этом отделении сложно',
      'В настоящее время на отделении',
      'Студенты принимают активное участие',
      'За отличные успехи в учебе',
      'За большой вклад в дело обучения',
      'Материально-техническая база',
      'Гордостью техникума и отделения',
      'Наши выпускники - командиры',
      'Построение и развитие',
      'Область профессиональной деятельности',
      'Динамичное развитие отрасли',
      'В условиях высокоразвитой системы',
    ];
  
    // Разделяем текст на параграфы
    const paragraphs = description.split('\n\n');
  
    return paragraphs.map((paragraph, pIndex) => {
      // Проверяем, начинается ли параграф с ключевой фразы
      const isHeading = headings.some(h => paragraph.startsWith(h) && paragraph.length < 100); // Добавим проверку длины, чтобы не делать заголовком длинный текст
      
      // Проверяем, является ли параграф списком специальностей
      if (paragraph.startsWith('Специальности:\n-')) {
        const items = paragraph.split('\n'); // Разделяем на заголовок и пункты
        const title = items.shift(); // Забираем 'Специальности:'
        return (
          <div key={pIndex} className="my-5">
            <h3 className="text-xl font-semibold text-primary mb-3">{title}</h3>
            <ul className="list-disc list-inside space-y-2 text-gray-700">
              {items.map((item, iIndex) => (
                <li key={iIndex}>{item.substring(2).trim()}</li> // Убираем '- '
              ))}
            </ul>
          </div>
        );
      }
      
      // Если это заголовок
      if (isHeading) {
        return (
          <h3 key={pIndex} className="text-xl font-semibold text-gray-800 mt-6 mb-3">
            {paragraph}
          </h3>
        );
      }
      
      // Обычный параграф
      return (
        <p key={pIndex} className="text-gray-700 leading-relaxed text-justify text-base mb-4">
          {paragraph}
        </p>
      );
    });
  };


  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-blue-50">
      <Header />
      
      <div className="flex">
        <Sidebar />
        
        <main className="flex-1 min-h-screen">
          <div className="container mx-auto px-6 py-8">
            <InfoBlocks />
            
            <div className="bg-white rounded-2xl shadow-xl border border-gray-200 p-8 md:p-12">
              <h1 className="text-4xl md:text-5xl font-extrabold text-primary mb-4 text-center tracking-tight flex items-center justify-center">
                 <BookOpen className="w-10 h-10 mr-4 text-accent" />
                Наши отделения
              </h1>
              <p className="text-center text-lg text-muted-foreground mb-16 max-w-3xl mx-auto">
                 Исследуйте наши передовые отделения и специальности, которые формируют будущее железнодорожного транспорта и смежных отраслей.
               </p>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-8"> {/* Возвращаем 2 колонки для большего места */}
                {departments.map((dept) => {
                  const IconComponent = dept.icon;
                  // ✅ УНИКАЛЬНЫЕ ЦВЕТА
                  const colors = {
                    blue: { gradient: 'from-blue-50 to-indigo-100', border: 'border-blue-200', text: 'text-blue-800', iconBg: 'bg-blue-100', iconText: 'text-blue-600', buttonBg: 'bg-blue-600 hover:bg-blue-700', buttonOutline: 'border-blue-500 text-blue-700 hover:bg-blue-50' },
                    yellow: { gradient: 'from-yellow-50 to-amber-100', border: 'border-yellow-200', text: 'text-amber-800', iconBg: 'bg-yellow-100', iconText: 'text-amber-600', buttonBg: 'bg-yellow-500 hover:bg-yellow-600', buttonOutline: 'border-yellow-500 text-yellow-700 hover:bg-yellow-50' },
                    orange: { gradient: 'from-orange-50 to-red-100', border: 'border-orange-200', text: 'text-orange-800', iconBg: 'bg-orange-100', iconText: 'text-orange-600', buttonBg: 'bg-orange-500 hover:bg-orange-600', buttonOutline: 'border-orange-500 text-orange-700 hover:bg-orange-50' },
                    green: { gradient: 'from-green-50 to-emerald-100', border: 'border-green-200', text: 'text-green-800', iconBg: 'bg-green-100', iconText: 'text-green-600', buttonBg: 'bg-green-600 hover:bg-green-700', buttonOutline: 'border-green-500 text-green-700 hover:bg-green-50' },
                    purple: { gradient: 'from-purple-50 to-violet-100', border: 'border-purple-200', text: 'text-purple-800', iconBg: 'bg-purple-100', iconText: 'text-purple-600', buttonBg: 'bg-purple-600 hover:bg-purple-700', buttonOutline: 'border-purple-500 text-purple-700 hover:bg-purple-50' },
                  };
                  const theme = colors[dept.color as keyof typeof colors] || colors.blue;

                  return (
                    <div 
                      key={dept.id} 
                      className={`relative ${theme.gradient} rounded-2xl shadow-lg border ${theme.border} p-6
                                 transform transition-all duration-300 hover:scale-[1.03] hover:shadow-xl 
                                 flex flex-col group overflow-hidden`}
                    >
                      <div className={`absolute top-0 left-0 w-full h-2 ${theme.buttonBg}`}></div>

                      <div className="flex-1 flex flex-col pt-6">
                        
                        <div className="flex items-start space-x-4 mb-5">
                          <div className={`relative w-20 h-20 ${theme.iconBg} rounded-full p-2.5 shadow-md flex items-center justify-center flex-shrink-0 border-2 border-white ring-2 ${theme.border}`}>
                            {dept.departmentImage ? (
                                <img src={dept.departmentImage} alt={`Лого ${dept.name}`} className="w-full h-full object-contain"/>
                            ) : (
                                <IconComponent className={`w-10 h-10 ${theme.iconText}`} />
                            )}
                          </div>
                          {/* ✅ ИСПРАВЛЕНИЕ: Полное название отделения */}
                          <h2 className={`text-2xl font-bold ${theme.text} leading-tight`}>{dept.name}</h2>
                        </div>

                        {/* ✅ ИСПРАВЛЕНИЕ: Прямоугольная аватарка */}
                        <div 
                          className="flex items-center space-x-4 mb-6 bg-white/60 p-4 rounded-lg border border-gray-100 shadow-sm cursor-pointer group/avatar"
                          onClick={(e) => { e.stopPropagation(); setLightboxImage(dept.headPhoto); }}
                        >
                            <div className="w-32 h-40 rounded-lg overflow-hidden flex-shrink-0 border-2 border-white shadow">
                              <img 
                                src={dept.headPhoto} 
                                alt={dept.head} 
                                className="w-full h-full object-cover transition-transform duration-300 group-hover/avatar:scale-105"
                              />
                            </div>
                            <div>
                                <p className="text-sm font-medium text-gray-500">Заведующий:</p>
                                <p className={`text-lg font-semibold ${theme.text}`}>{dept.head}</p>
                            </div>
                        </div>

                        <div className="mb-6 flex-1">
                          <h3 className="font-semibold text-gray-700 mb-3 text-base">Специальности:</h3>
                          <ul className="space-y-2">
                            {dept.specialties.map((specialty, index) => (
                              <li key={index} className="flex items-start text-sm text-gray-700"> {/* Уменьшен шрифт для длинных названий */}
                                <ChevronRight className={`w-4 h-4 mr-1.5 mt-0.5 ${theme.iconText} flex-shrink-0`} /> {specialty}
                              </li>
                            ))}
                          </ul>
                        </div>

                        <div className="flex flex-col sm:flex-row justify-center gap-3 mt-auto pt-4 border-t border-gray-200/60">
                          <Button 
                            onClick={() => openDescriptionModal(dept.id)}
                             // ✅ ИСПРАВЛЕНИЕ: Кнопка "Подробнее" теперь с темным текстом
                            variant="outline"
                            className={`${theme.buttonOutline} bg-white/80 px-5 py-2.5 text-sm rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 w-full sm:w-auto flex items-center justify-center`}
                          >
                            <BookOpen className="w-4 h-4 mr-2" />
                            Подробнее
                          </Button>
                          <Button 
                            onClick={(e) => { e.stopPropagation(); window.open(dept.videoUrl, '_blank'); }}
                            className={`${theme.buttonBg} ${theme.hoverBgColor} text-white px-5 py-2.5 text-sm rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 w-full sm:w-auto flex items-center justify-center`}
                          >
                            <Play className="w-4 h-4 mr-2" />
                            Визитка
                          </Button>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </main>
        
        <aside className="w-80 bg-white border-l border-border p-6 sticky top-16 h-screen overflow-y-auto">
          <SidebarCards />
        </aside>
      </div>

      {/* Диалоговое окно для Описания */}
      <Dialog open={isDescriptionOpen} onOpenChange={setIsDescriptionOpen}>
        <DialogContent className="max-w-4xl lg:max-w-5xl max-h-[90vh] overflow-y-auto p-8 rounded-xl shadow-2xl bg-white">
          {activeDepartment && (
            <>
              <DialogHeader className="text-center pb-4 border-b border-gray-200 mb-6 relative">
                 {activeDepartment.icon && (
                    <div className={`mx-auto w-16 h-16 bg-gradient-to-br from-${activeDepartment.color}-100 to-${activeDepartment.color}-200 rounded-full p-3 shadow-lg border-4 border-white flex items-center justify-center`}>
                       <activeDepartment.icon className={`w-8 h-8 text-${activeDepartment.color}-600`} />
                    </div>
                 )}
                <DialogTitle className="text-3xl font-extrabold text-primary pt-4">
                  {activeDepartment.name}
                </DialogTitle>
                <p className="text-lg text-muted-foreground mt-2">{activeDepartment.head}</p>
              </DialogHeader>
              {/* ✅ ИСПОЛЬЗУЕМ НОВЫЙ РЕНДЕРИНГ ТЕКСТА */}
              <div className="prose prose-lg max-w-none text-gray-800 leading-relaxed space-y-4">
                 {renderDescription(activeDepartment.description)}
              </div>
            </>
          )}
        </DialogContent>
      </Dialog>
      
      {/* ✅ Лайтбокс для Аватарок */}
      {lightboxImage && (
        <div 
          className="fixed inset-0 bg-black/80 z-[80] flex items-center justify-center p-4" 
          onClick={() => setLightboxImage(null)} // Закрытие по клику на фон
        >
          <img 
            src={lightboxImage} 
            alt="Фото заведующего" 
            className="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
            onClick={(e) => e.stopPropagation()} // Не закрывать по клику на саму картинку
          />
          <button 
            onClick={() => setLightboxImage(null)} 
            className="absolute top-4 right-4 text-white bg-black/30 rounded-full p-2 hover:bg-black/50 transition-colors"
          >
            <X className="w-7 h-7" />
          </button>
        </div>
      )}
    </div>
  );
};

export default Departments;